<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Transcriptor y Resumen de Clases</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .tab-content { margin-top: 20px; }
        .humanize-section { margin-top: 30px; }
    </style>
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="mb-4">Transcriptor y Resumen de Clases</h1>
        
        <!-- Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="transcribe-tab" data-bs-toggle="tab" data-bs-target="#transcribe" type="button" role="tab">Transcribir Video</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="humanize-tab" data-bs-toggle="tab" data-bs-target="#humanize" type="button" role="tab">Humanizar Texto</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="summarize-tab" data-bs-toggle="tab" data-bs-target="#summarize" type="button" role="tab">Resumir Texto</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="compress-tab" data-bs-toggle="tab" data-bs-target="#compress" type="button" role="tab">Comprimir Medios</button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- Tab Transcribir -->
            <div class="tab-pane fade show active" id="transcribe" role="tabpanel">
                <form id="uploadForm" enctype="multipart/form-data" class="mb-4">
                    <div class="mb-3">
                        <label for="file" class="form-label">Selecciona tu clase en video (MP4, AVI, MOV, MKV):</label>
                        <input class="form-control" type="file" id="file" name="file" accept="video/*" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Subir y Procesar</button>
                </form>
                <div id="progress" class="mb-3" style="display:none;">
                    <div class="spinner-border text-primary" role="status"></div>
                    <span class="ms-2">Procesando, por favor espera...</span>
                </div>
                <div id="result" style="display:none;">
                    <h3>Resumen</h3>
                    <pre id="summary" class="bg-white p-3 border rounded"></pre>
                    <h3>Transcripción Completa</h3>
                    <pre id="transcription" class="bg-white p-3 border rounded"></pre>
                    <a id="downloadLink" class="btn btn-success mt-3" href="#" download>Descargar resultado</a>
                </div>
            </div>
            
            <!-- Tab Humanizar -->
            <div class="tab-pane fade" id="humanize" role="tabpanel">
                <div class="mb-3">
                    <label for="inputText" class="form-label">Pega aquí el texto que deseas humanizar:</label>
                    <textarea class="form-control" id="inputText" rows="10" placeholder="Escribe o pega el texto aquí..."></textarea>
                </div>
                <button id="humanizeBtn" class="btn btn-primary">Humanizar Texto</button>
                <div id="humanizeProgress" class="mt-3" style="display:none;">
                    <div class="spinner-border text-primary" role="status"></div>
                    <span class="ms-2">Procesando...</span>
                </div>
                <div id="humanizeResult" class="mt-4" style="display:none;">
                    <h3>Texto Humanizado</h3>
                    <pre id="humanizedText" class="bg-white p-3 border rounded"></pre>
                    <button id="copyBtn" class="btn btn-secondary mt-2">Copiar al portapapeles</button>
                </div>
            </div>
            
            <!-- Tab Resumir -->
            <div class="tab-pane fade" id="summarize" role="tabpanel">
                <div class="mb-3">
                    <label for="summarizeInput" class="form-label">Pega aquí el texto que deseas resumir:</label>
                    <textarea class="form-control" id="summarizeInput" rows="10" placeholder="Escribe o pega el texto aquí..."></textarea>
                </div>
                <div class="mb-3">
                    <label for="percentageSlider" class="form-label">Porcentaje del resumen: <span id="percentageValue">30</span>%</label>
                    <input type="range" class="form-range" id="percentageSlider" min="10" max="70" value="30">
                </div>
                <button id="summarizeBtn" class="btn btn-primary">Resumir Texto</button>
                <div id="summarizeProgress" class="mt-3" style="display:none;">
                    <div class="spinner-border text-primary" role="status"></div>
                    <span class="ms-2">Procesando...</span>
                </div>
                <div id="summarizeResult" class="mt-4" style="display:none;">
                    <h3>Resumen</h3>
                    <pre id="summaryText" class="bg-white p-3 border rounded"></pre>
                    <h3>Palabras Clave</h3>
                    <div id="keywordsList" class="bg-white p-3 border rounded"></div>
                    <button id="copySummaryBtn" class="btn btn-secondary mt-2">Copiar Resumen</button>
                </div>
            </div>
            
            <!-- Tab Comprimir Medios -->
            <div class="tab-pane fade" id="compress" role="tabpanel">
                <ul class="nav nav-tabs" id="compressTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="compress-image-tab" data-bs-toggle="tab" data-bs-target="#compress-image" type="button" role="tab">Comprimir Imagen</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="convert-image-tab" data-bs-toggle="tab" data-bs-target="#convert-image" type="button" role="tab">Convertir Imagen</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="compress-video-tab" data-bs-toggle="tab" data-bs-target="#compress-video" type="button" role="tab">Comprimir Video</button>
                    </li>
                </ul>
                
                <div class="tab-content mt-3">
                    <!-- Comprimir Imagen -->
                    <div class="tab-pane fade show active" id="compress-image" role="tabpanel">
                        <div class="mb-3">
                            <label for="imageFile" class="form-label">Selecciona una imagen:</label>
                            <input class="form-control" type="file" id="imageFile" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label for="imageQuality" class="form-label">Calidad: <span id="qualityValue">75</span>%</label>
                            <input type="range" class="form-range" id="imageQuality" min="1" max="95" value="75">
                        </div>
                        <div class="mb-3">
                            <label for="maxWidth" class="form-label">Ancho máximo (píxeles):</label>
                            <input class="form-control" type="number" id="maxWidth" value="1920">
                        </div>
                        <button id="compressImageBtn" class="btn btn-primary">Comprimir Imagen</button>
                        <div id="compressImageProgress" class="mt-3" style="display:none;">
                            <div class="spinner-border text-primary" role="status"></div>
                            <span class="ms-2">Comprimiendo...</span>
                        </div>
                        <div id="compressImageResult" class="mt-4" style="display:none;">
                            <h5>Resultados:</h5>
                            <p id="compressImageInfo"></p>
                            <a id="downloadCompressedImage" class="btn btn-success">Descargar imagen comprimida</a>
                        </div>
                    </div>
                    
                    <!-- Convertir Imagen -->
                    <div class="tab-pane fade" id="convert-image" role="tabpanel">
                        <div class="mb-3">
                            <label for="convertImageFile" class="form-label">Selecciona una imagen:</label>
                            <input class="form-control" type="file" id="convertImageFile" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label for="imageFormat" class="form-label">Formato de salida:</label>
                            <select class="form-control" id="imageFormat">
                                <option value="webp">WebP (Recomendado)</option>
                                <option value="jpg">JPG</option>
                                <option value="png">PNG</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="convertQuality" class="form-label">Calidad: <span id="convertQualityValue">80</span>%</label>
                            <input type="range" class="form-range" id="convertQuality" min="1" max="95" value="80">
                        </div>
                        <button id="convertImageBtn" class="btn btn-primary">Convertir Imagen</button>
                        <div id="convertImageProgress" class="mt-3" style="display:none;">
                            <div class="spinner-border text-primary" role="status"></div>
                            <span class="ms-2">Convirtiendo...</span>
                        </div>
                        <div id="convertImageResult" class="mt-4" style="display:none;">
                            <h5>Resultados:</h5>
                            <p id="convertImageInfo"></p>
                            <a id="downloadConvertedImage" class="btn btn-success">Descargar imagen convertida</a>
                        </div>
                    </div>
                    
                    <!-- Comprimir Video -->
                    <div class="tab-pane fade" id="compress-video" role="tabpanel">
                        <div class="mb-3">
                            <label for="videoFile" class="form-label">Selecciona un video:</label>
                            <input class="form-control" type="file" id="videoFile" accept="video/*">
                        </div>
                        <div class="mb-3">
                            <label for="videoQuality" class="form-label">Calidad de salida:</label>
                            <select class="form-control" id="videoQuality">
                                <option value="low">Baja (360p) - Máxima compresión</option>
                                <option value="medium" selected>Media (720p) - Recomendado</option>
                                <option value="high">Alta (1080p) - Menor compresión</option>
                            </select>
                        </div>
                        <button id="compressVideoBtn" class="btn btn-primary">Comprimir Video</button>
                        <div id="compressVideoProgress" class="mt-3" style="display:none;">
                            <div class="spinner-border text-primary" role="status"></div>
                            <span class="ms-2">Comprimiendo video (esto puede tomar varios minutos)...</span>
                        </div>
                        <div id="compressVideoResult" class="mt-4" style="display:none;">
                            <h5>Resultados:</h5>
                            <p id="compressVideoInfo"></p>
                            <a id="downloadCompressedVideo" class="btn btn-success">Descargar video comprimido</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Tab Transcribir
    document.getElementById('uploadForm').onsubmit = async function(e) {
        e.preventDefault();
        document.getElementById('progress').style.display = 'block';
        document.getElementById('result').style.display = 'none';
        const fileInput = document.getElementById('file');
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        // Subir archivo
        let uploadRes = await fetch('/upload', {
            method: 'POST',
            body: formData
        });
        let uploadData = await uploadRes.json();
        if (!uploadData.success) {
            alert(uploadData.error || 'Error al subir el archivo');
            document.getElementById('progress').style.display = 'none';
            return;
        }
        // Procesar archivo
        let processRes = await fetch('/process', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({filename: uploadData.filename, generate_summary: true})
        });
        let processData = await processRes.json();
        document.getElementById('progress').style.display = 'none';
        if (!processData.success) {
            alert(processData.error || 'Error al procesar el archivo');
            return;
        }
        document.getElementById('summary').textContent = processData.summary;
        document.getElementById('transcription').textContent = processData.transcription;
        document.getElementById('downloadLink').href = '/download/' + processData.output_file;
        document.getElementById('downloadLink').style.display = 'inline-block';
        document.getElementById('result').style.display = 'block';
    };
    
    // Tab Humanizar
    document.getElementById('humanizeBtn').onclick = async function() {
        const text = document.getElementById('inputText').value;
        if (!text) {
            alert('Por favor ingresa texto para humanizar');
            return;
        }
        document.getElementById('humanizeProgress').style.display = 'block';
        document.getElementById('humanizeResult').style.display = 'none';
        
        let res = await fetch('/humanize', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: text})
        });
        let data = await res.json();
        document.getElementById('humanizeProgress').style.display = 'none';
        
        if (!data.success) {
            alert(data.error || 'Error al humanizar el texto');
            return;
        }
        
        document.getElementById('humanizedText').textContent = data.humanized_text;
        document.getElementById('humanizeResult').style.display = 'block';
    };
    
    // Copiar al portapapeles
    document.getElementById('copyBtn').onclick = function() {
        const text = document.getElementById('humanizedText').textContent;
        navigator.clipboard.writeText(text).then(() => {
            alert('Texto copiado al portapapeles');
        });
    };
    
    // Tab Resumir
    document.getElementById('percentageSlider').oninput = function() {
        document.getElementById('percentageValue').textContent = this.value;
    };
    
    document.getElementById('summarizeBtn').onclick = async function() {
        const text = document.getElementById('summarizeInput').value;
        const percentage = document.getElementById('percentageSlider').value;
        
        if (!text) {
            alert('Por favor ingresa texto para resumir');
            return;
        }
        document.getElementById('summarizeProgress').style.display = 'block';
        document.getElementById('summarizeResult').style.display = 'none';
        
        let res = await fetch('/summarize', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: text, percentage: parseInt(percentage)})
        });
        let data = await res.json();
        document.getElementById('summarizeProgress').style.display = 'none';
        
        if (!data.success) {
            alert(data.error || 'Error al resumir el texto');
            return;
        }
        
        document.getElementById('summaryText').textContent = data.summary;
        const keywordsList = document.getElementById('keywordsList');
        keywordsList.innerHTML = '<strong>Palabras clave:</strong><br>' + data.keywords.join(', ');
        document.getElementById('summarizeResult').style.display = 'block';
    };
    
    document.getElementById('copySummaryBtn').onclick = function() {
        const text = document.getElementById('summaryText').textContent;
        navigator.clipboard.writeText(text).then(() => {
            alert('Resumen copiado al portapapeles');
        });
    };
    
    // Comprimir Imagen
    document.getElementById('imageQuality').oninput = function() {
        document.getElementById('qualityValue').textContent = this.value;
    };
    
    document.getElementById('compressImageBtn').onclick = async function() {
        const file = document.getElementById('imageFile').files[0];
        if (!file) {
            alert('Por favor selecciona una imagen');
            return;
        }
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('quality', document.getElementById('imageQuality').value);
        formData.append('max_width', document.getElementById('maxWidth').value);
        
        document.getElementById('compressImageProgress').style.display = 'block';
        document.getElementById('compressImageResult').style.display = 'none';
        
        let res = await fetch('/compress-image', {
            method: 'POST',
            body: formData
        });
        let data = await res.json();
        document.getElementById('compressImageProgress').style.display = 'none';
        
        if (!data.success) {
            alert(data.error || 'Error al comprimir la imagen');
            return;
        }
        
        const info = `
            <strong>Tamaño original:</strong> ${data.original_size}<br>
            <strong>Tamaño comprimido:</strong> ${data.compressed_size}<br>
            <strong>Reducción:</strong> ${data.compression_ratio}<br>
            <strong>Resolución:</strong> ${data.original_resolution}
        `;
        document.getElementById('compressImageInfo').innerHTML = info;
        document.getElementById('downloadCompressedImage').href = '/download/' + data.download_file;
        document.getElementById('compressImageResult').style.display = 'block';
    };
    
    // Convertir Imagen
    document.getElementById('convertQuality').oninput = function() {
        document.getElementById('convertQualityValue').textContent = this.value;
    };
    
    document.getElementById('convertImageBtn').onclick = async function() {
        const file = document.getElementById('convertImageFile').files[0];
        if (!file) {
            alert('Por favor selecciona una imagen');
            return;
        }
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('format', document.getElementById('imageFormat').value);
        formData.append('quality', document.getElementById('convertQuality').value);
        
        document.getElementById('convertImageProgress').style.display = 'block';
        document.getElementById('convertImageResult').style.display = 'none';
        
        let res = await fetch('/convert-image', {
            method: 'POST',
            body: formData
        });
        let data = await res.json();
        document.getElementById('convertImageProgress').style.display = 'none';
        
        if (!data.success) {
            alert(data.error || 'Error al convertir la imagen');
            return;
        }
        
        const info = `
            <strong>Tamaño original:</strong> ${data.original_size}<br>
            <strong>Tamaño convertido:</strong> ${data.converted_size}<br>
            <strong>Reducción:</strong> ${data.compression_ratio}<br>
            <strong>Formato:</strong> ${data.format}
        `;
        document.getElementById('convertImageInfo').innerHTML = info;
        document.getElementById('downloadConvertedImage').href = '/download/' + data.download_file;
        document.getElementById('convertImageResult').style.display = 'block';
    };
    
    // Comprimir Video
    document.getElementById('compressVideoBtn').onclick = async function() {
        const file = document.getElementById('videoFile').files[0];
        if (!file) {
            alert('Por favor selecciona un video');
            return;
        }
        
        const formData = new FormData();
        formData.append('file', file);
        formData.append('quality', document.getElementById('videoQuality').value);
        
        document.getElementById('compressVideoProgress').style.display = 'block';
        document.getElementById('compressVideoResult').style.display = 'none';
        
        let res = await fetch('/compress-video', {
            method: 'POST',
            body: formData
        });
        let data = await res.json();
        document.getElementById('compressVideoProgress').style.display = 'none';
        
        if (!data.success) {
            alert(data.error || 'Error al comprimir el video');
            return;
        }
        
        const info = `
            <strong>Tamaño original:</strong> ${data.original_size}<br>
            <strong>Tamaño comprimido:</strong> ${data.compressed_size}<br>
            <strong>Reducción:</strong> ${data.compression_ratio}<br>
            <strong>Resolución:</strong> ${data.resolution}<br>
            <strong>Calidad:</strong> ${data.quality}
        `;
        document.getElementById('compressVideoInfo').innerHTML = info;
        document.getElementById('downloadCompressedVideo').href = '/download/' + data.download_file;
        document.getElementById('compressVideoResult').style.display = 'block';
    };
    </script>
</body>
</html>
